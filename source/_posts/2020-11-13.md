---
title: 'hexo博客 + nginx + https-ssl'
date: 2020-11-13 15:28:57
tags:
---
# 前言
紧接上篇文章，想在个人博客上添加ssl证书，能够https访问个人网站。

<!--more-->

# 下载申请免费ssl证书
1.免费购买证书
![Lena](/images/2020_11_13_pic00.png)
![Lena](/images/2020_11_13_pic01.png)
![Lena](/images/2020_11_13_pic02.png)
2.证书申请
![Lena](/images/2020_11_13_pic03.png)
3.配置到域名解析列表
在域名dns中添加txt信息
4.证书验证
5.证书部署
6.证书下载
下载生成 证书文件 和 私钥文件
```
[root@para1 www]# ls 4757052_www.padparadccha.cn.*
4757052_www.padparadccha.cn.key  4757052_www.padparadccha.cn.pem
```

# nginx 更新 http_ssl 模块
1.查看nginx是否安装http_ssl_module模块
```
$ /usr/local/nginx/sbin/nginx -V
```
如果出现 configure arguments: --with-http_ssl_module, 则已安装（下面的步骤可以跳过，进入 nginx.conf 配置）。
2.需要新安装的模块，重新编译 
下载添加 ngx_http_google_filter_module
```
git clone https://github.com/cuber/ngx_http_google_filter_module
```
下载添加 ngx_http_substitutions_filter_module
```
git clone https://github.com/yaoweibin/ngx_http_substitutions_filter_module
```
3.安装 编译新的nginx
进入nginx的源文件目录 
```
[root@para1 nginx]# sbin/nginx -V
nginx version: nginx/1.18.0
built by gcc 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) 
built with OpenSSL 1.1.1g  21 Apr 2020
TLS SNI support enabled
configure arguments: --prefix=/usr/local/nginx --with-http_gzip_static_module --http-client-body-temp-path=/usr/local/nginx/tmp/client/ --http-proxy-temp-path=/usr/local/nginx/tmp/proxy/ --http-fastcgi-temp-path=/usr/local/nginx/tmp/fcgi/ --with-poll_module --with-file-aio --with-http_realip_module --with-http_addition_module --with-http_addition_module --with-http_random_index_module --with-http_stub_status_module --http-uwsgi-temp-path=/usr/local/nginx/uwsgi_temp --http-scgi-temp-path=/usr/local/nginx/scgi_temp --with-stream 
```
添加新的--with-http_ssl_module模块和配置两个add-module路径
```
./configure --prefix=/usr/local/nginx --with-openssl=/usr/local/openssl --with-http_ssl_module --with-http_gzip_static_module --http-client-body-temp-path=/usr/local/nginx/tmp/client/ --http-proxy-temp-path=/usr/local/nginx/tmp/proxy/ --http-fastcgi-temp-path=/usr/local/nginx/tmp/fcgi/ --with-poll_module --with-file-aio --with-http_realip_module --with-http_addition_module --with-http_addition_module --with-http_random_index_module --with-http_stub_status_module --http-uwsgi-temp-path=/usr/local/nginx/uwsgi_temp --http-scgi-temp-path=/usr/local/nginx/scgi_temp --with-stream --add-module=/root/data/ngx_http_google_filter_module --add-module=/root/data/ngx_http_substitutions_filter_module
```
4.make 注:千万不要make install 那样就会覆盖安装
5.将原来的 Nginx备份，拷贝新生成的nginx
```
cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak
cp objs/nginx /usr/local/nginx/sbin/nginx
```

# nginx 配置文件
修改 nginx.conf 如下：
```
http {

    server {
        listen       80;
        server_name  www.padparadccha.cn;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   /home/git/project/blog;
            index  index.html index.htm;
        }


    server {
        listen       443 ssl;
        server_name  www.padparadccha.cn;

        ssl_certificate      cert.pem;
        ssl_certificate_key  cert.key;

        ssl_session_cache    shared:SSL:1m;
        ssl_session_timeout  5m;

        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers  on;

        location / {
            root   /home/git/project/blog;
            index  index.html index.htm;
        }
   }

   [...]
}

[...]
```
listen	ssl访问端口号为 443
ssl_certificate 证书文件
ssl_certificate_key 私钥文件
ssl_ciphers  配置加密套件，写法遵循openssl标准

# 启动
/usr/local/nginx/sbin/nginx

# 关于https的文章
https://www.cnblogs.com/zery/p/5164795.html

