---
title: 'hexo博客部署到服务器'
date: 2020-11-12 14:01:38
tags:
---
# 前言
之前博客都是放在github page上进行部署，现在用nginx部署在自己的服务器上
前面的基本配置，简单略过，详细可以参考hexo官方文档
本篇主要在服务器建立一个裸仓库，本地将静态页面上传到服务器，用nginx进行部署

<!--more-->
# 基本配置
## 本地安装 node
1.node官网下载 推荐使用nvm
2.配置全局变量
3.安装hexo-cli

## 初始化hexo
1.初始化
```
hexo init myblo && myblog
npm i
```
2.下载主题
git clone https://github.com/iissnan/hexo-theme-next themes/next
3.本地执行hexo项目 npm start
添加 start脚本 
![Lena](/images/pic01.png)
4.验证效果

## git环境搭建
1.git 安装
2.ssh 认证
```
git config --global user.name "yourname"
git config --global user.email youremail@example.com
ssh-keygen -t rsa -C "youremail@example.com"
git config --global core.autocrlf false  // 禁用自动转换，这个不设置后面上传时会出现警告，如下
```
# 服务器配置
## 搭建远程Git私库
1.登录远程服务器
2.安装git
```
git --version // 如无，则安装
yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel
yum install -y git
```
3.创建用户并配置其仓库
```
useradd git
passwd git // 设置密码
su git // 这步很重要，不切换用户后面会很麻烦
cd /home/git/
mkdir -p projects/blog // 项目存在的真实目录
mkdir repos && cd repos
git init --bare blog.git // 创建一个裸露的仓库
cd blog.git/hooks
vi post-receive // 创建 hook 钩子函数，输入了内容如下
#输入完成后
chmod +x post-receive
exit // 退出到 root 登录
chown -R git:git /home/git/repos/blog.git // 添加权限
```
```
file  post-receive:
#!/bin/sh
git --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f
#将传到/home/git/repos/blog.git地址的文件，放到/home/git/projects/blog
```
4.测试git仓库是否可用
```
git clone git@server_ip:/home/git/repos/blog.git
```
5.本地电脑 建立ssh信任关系
```
ssh-copy-id -i C:/Users/yourname/.ssh/id_rsa.pub git@server_ip
ssh git@server_ip // 测试能否登录
```
6.禁用git用户的shell登录权限
```
cat /etc/shells // 查看 git-shell 是否在登录方式里面
which git-shell // 查看是否安装
vi /etc/shells
#添加上2步显示出来的路径，通常在 /usr/bin/git-shell
```
修改/etc/passwd中的权限
```
// 将原来的
git:x:1000:1000::/home/git:/bin/bash

// 修改为
git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell
```

# 搭建nginx服务器
## 下载安装 nginx
```
cd /usr/local/src
wget http://nginx.org/download/nginx-1.15.2.tar.gz
tar xzvf nginx-1.15.2.tar.gz
cd nginx-1.15.2
./configure // 如果后面还想要配置 SSL 协议，就执行后面一句！
./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module
make && make install
alias nginx='/usr/local/nginx/sbin/nginx' // 为 nginx 取别名，后面可直接用
```

## 配置nginx文件
1.先启动是否安装成功
```
nginx 
#浏览器查看 server_ip，默认是 80 端口
```

2.修改配置文件
```
nginx -s stop // 先停止nginx
cd /usr/local/nginx/conf
vi nginx.conf
修改 root 解析路径, 如下图
同时将 user 改为 root, 不然nginx无法访问 /home/git/projects/blog
nginx
```
![Lena](/images/2020_11_12_pic02.png)

# 发布
## 本地配置 _config.yml文件
![Lena](/images/2020_11_12_pic03.png)
## 在package.json 中添加npm脚本
## 链接 
本地调试 npm start
上次服务器 npm run deply