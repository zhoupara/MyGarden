---
title: makefile制作静态库和动态库
date: 2021-01-11 19:16:42
tags:
---
makefile的基本以及动态库和静态库的基本自行百度
本文主要将如何用makefile制作动态库和静态库以及使用

<!--more-->

# main.c  add.c  add.h 文件
## 三个文件
![Lena](/images/2021-01-11/add_c.png)
![Lena](/images/2021-01-11/add_h.png)
![Lena](/images/2021-01-11/main_c.png)

## 文件存放目录结构
![Lena](/images/2021-01-11/tree.png)

# 静态库文件
## 静态库文件的制作
```
制作.o文件
	gcc -c *.c
用ar打包生成.a静态库文件
	ar cr 静态库的名字(libMytest.a) 生成的所有的.o
```
![Lena](/images/2021-01-11/a.png)

## 静态库文件的调用
1.gcc main.c lib/libadd.a -I include -o main
2.gcc main.c -I include -L lib -l add -o main
nm libadd.a
![Lena](/images/2021-01-11/make_a.png)

# 动态库
## 动态库文件的制作
```
生成与位置无关的.o文件
	  gcc -fPIC -c *.c
生成.so动态库文件
	  gcc -shared -I include -o lib库名.so *.o
```
![Lena](/images/2021-01-11/so.png)

## 动态库文件的调用
1.gcc main.c lib/libMyCalc.so -I include -o app 可以直接加绝对路径编译
2.gcc main.c -I include -L lib -l MyCalc -o app 需要更新环境变量
ldd 
![Lena](/images/2021-01-11/make_so.png)

注： 第二种需要配置环境变量
```
LD_LIBRARY_PATH
export LD_LIBRARY_PATH=./lib
vi ~/.bashrc
export LD_LIBRARY_PATH=/home/lib

1.找到动态库链接器的配置文件 vi /etc/ld.so.conf
2.动态库的路径写到配置文件中
3.更新 sudo ldconfig -v 
```
